@page "/"
@using JWTDecoder.Services
@inject JwtDecoderService DecoderService
@inject IJSRuntime JSRuntime

<PageTitle>JWT Decoder</PageTitle>

<div class="jwt-decoder-container">
    <div class="header-section">
        <h1>JWT Decoder</h1>
        <p class="subtitle">Decode JSON Web Tokens client-side with no server calls</p>
    </div>

    <div class="input-section">
        <h3>Input JWT Token</h3>
        <textarea 
            class="jwt-input" 
            placeholder="Paste your JWT token here..."
            @bind="jwtInput"
            @oninput="OnInputChanged"
            rows="6"></textarea>
        <button class="btn-decode" @onclick="DecodeToken">Decode JWT</button>
    </div>

    @if (result != null)
    {
        @if (result.Success)
        {
            <div class="output-section">
                <div class="output-panel">
                    <div class="panel-header">
                        <h3>Header</h3>
                        <button class="btn-copy" @onclick="() => CopyToClipboard(result.Header!)">
                            📋 Copy
                        </button>
                    </div>
                    <pre class="json-output">@result.Header</pre>
                </div>

                <div class="output-panel">
                    <div class="panel-header">
                        <h3>Payload</h3>
                        <button class="btn-copy" @onclick="() => CopyToClipboard(result.Payload!)">
                            📋 Copy
                        </button>
                    </div>
                    <pre class="json-output">@result.Payload</pre>
                </div>

                <div class="output-panel">
                    <div class="panel-header">
                        <h3>Signature</h3>
                        <button class="btn-copy" @onclick="() => CopyToClipboard(result.Signature!)">
                            📋 Copy
                        </button>
                    </div>
                    <pre class="signature-output">@result.Signature</pre>
                </div>
            </div>
        }
        else
        {
            <div class="error-section">
                <h3>⚠️ Error</h3>
                <p class="error-message">@result.ErrorMessage</p>
            </div>
        }
    }

    <div class="footer-section">
        <p>All decoding happens client-side. No data is sent to any server.</p>
    </div>
</div>

@code {
    private string jwtInput = string.Empty;
    private JwtDecodedResult? result;

    private void DecodeToken()
    {
        result = DecoderService.DecodeJwt(jwtInput);
    }

    private void OnInputChanged(ChangeEventArgs e)
    {
        jwtInput = e.Value?.ToString() ?? string.Empty;
        // Optional: Auto-decode on input change
        // Uncomment the next line for real-time validation
        // DecodeToken();
    }

    private async Task CopyToClipboard(string text)
    {
        try
        {
            await JSRuntime.InvokeVoidAsync("navigator.clipboard.writeText", text);
        }
        catch (Exception)
        {
            // Fallback for older browsers
            Console.WriteLine("Clipboard API not available");
        }
    }
}
